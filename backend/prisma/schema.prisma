datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id          Int          @id @default(autoincrement())
  name        String
  email       String       @unique
  role        String
  createdAt   DateTime     @default(now())
  
  teams       Team[]       @relation("TeamMembers")
  submissions Submission[] @relation("UserSubmissions")
  judges      Judge[]
}

model Event {
  id          Int          @id @default(autoincrement())
  title       String
  description String
  organizerId Int
  createdAt   DateTime     @default(now())

  teams       Team[]
  submissions Submission[]
  judges      Judge[]
}

model Team {
  id       Int          @id @default(autoincrement())
  name     String
  eventId  Int
  event    Event        @relation(fields: [eventId], references: [id])
  
  members  User[]       @relation("TeamMembers")
  submissions Submission[]
}

model Submission {
  id          Int        @id @default(autoincrement())
  title       String
  description String
  githubLink  String?
  videoLink   String?
  files       String?
  
  teamId      Int
  team        Team       @relation(fields: [teamId], references: [id])
  
  eventId     Int
  event       Event      @relation(fields: [eventId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  userId      Int
  user        User       @relation("UserSubmissions", fields: [userId], references: [id])
  
  scores      Score[]
}

model Judge {
  id      Int      @id @default(autoincrement())
  
  userId  Int
  user    User     @relation(fields: [userId], references: [id])
  
  eventId Int
  event   Event    @relation(fields: [eventId], references: [id])
  
  scores  Score[]
}

model Score {
  id           Int        @id @default(autoincrement())
  
  submissionId Int
  submission   Submission @relation(fields: [submissionId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  judgeId      Int
  judge        Judge      @relation(fields: [judgeId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  round        Int
  score        Float
  feedback     String?
}
